<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–£–∫–ª–æ–Ω—è–π—Å—è –∏ –°–æ–±–∏—Ä–∞–π!</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 10px;
      }
      h1 {
        margin-bottom: 10px;
        font-size: 28px;
      }
      canvas {
        background: rgb(50, 50, 50);
        display: block;
        margin: 10px auto;
        border: 2px solid black;
        max-width: 100%;
        touch-action: none;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 10px;
      }
      button {
        margin: 5px;
        padding: 16px 22px;
        font-size: 24px;
        border: none;
        border-radius: 12px;
        background: #444;
        color: white;
        cursor: pointer;
        min-width: 60px;
      }
      button:active {
        background: #666;
      }
      .high-score {
        font-size: 18px;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <h1>–£–∫–ª–æ–Ω—è–π—Å—è –∏ –°–æ–±–∏—Ä–∞–π!</h1>
    <p class="high-score">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="highScore">0</span></p>

    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="controls">
      <button onclick="move('up')">‚¨Ü</button>
    </div>
    <div class="controls">
      <button onclick="move('left')">‚¨Ö</button>
      <button onclick="move('down')">‚¨á</button>
      <button onclick="move('right')">‚û°</button>
    </div>
    <div class="controls">
      <button onclick="restartGame()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      let player, obstacles, bonuses, score, keys, playerSpeed, highScore;
      let gameInterval;

      highScore = localStorage.getItem("highScore") || 0;
      document.getElementById("highScore").textContent = highScore;

      function initGame() {
        player = { x: 180, y: 350, size: 20, speed: 5 };
        obstacles = [];
        bonuses = [];
        score = 0;
        keys = {};
        playerSpeed = 5;

        // –ù–∞—á–∏–Ω–∞–µ–º –ø–∞–¥–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
        gameInterval = setInterval(gameLoop, 1000 / 60);
      }

      function move(direction) {
        keys = {};
        keys[
          direction === "up"
            ? "ArrowUp"
            : direction === "down"
            ? "ArrowDown"
            : direction === "left"
            ? "ArrowLeft"
            : "ArrowRight"
        ] = true;
      }

      function restartGame() {
        if (score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore);
          document.getElementById("highScore").textContent = highScore;
        }
        clearInterval(gameInterval); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—Ç–∞—Ä—É—é –∏–≥—Ä—É
        initGame();
      }

      function spawnObstacle() {
        obstacles.push({
          x: Math.random() * (canvas.width - 20),
          y: -20,
          size: 20,
          speed: Math.random() * 2 + 2,
        });
      }

      function spawnBonus() {
        bonuses.push({
          x: Math.random() * (canvas.width - 10),
          y: -10,
          size: 10,
          speed: Math.random() * 2 + 2,
        });
      }

      function update() {
        if (keys["ArrowUp"] && player.y > 0) player.y -= player.speed;
        if (keys["ArrowDown"] && player.y < canvas.height - player.size)
          player.y += player.speed;
        if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
        if (keys["ArrowRight"] && player.x < canvas.width - player.size)
          player.x += player.speed;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
        obstacles.forEach((obstacle) => {
          obstacle.y += obstacle.speed;
        });

        bonuses.forEach((bonus) => {
          bonus.y += bonus.speed;
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏
        obstacles.forEach((obstacle) => {
          if (
            player.x < obstacle.x + obstacle.size &&
            player.x + player.size > obstacle.x &&
            player.y < obstacle.y + obstacle.size &&
            player.y + player.size > obstacle.y
          ) {
            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å —à–∏–ø–æ–º ‚Äî –∫–æ–Ω–µ—Ü –∏–≥—Ä—ã
            alert("–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª! –û—á–∫–∏: " + score);
            restartGame();
          }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–±–æ—Ä –±–æ–Ω—É—Å–æ–≤
        bonuses.forEach((bonus, index) => {
          if (
            player.x < bonus.x + bonus.size &&
            player.x + player.size > bonus.x &&
            player.y < bonus.y + bonus.size &&
            player.y + player.size > bonus.y
          ) {
            score += 10; // –ó–∞ –∫–∞–∂–¥—ã–π –±–æ–Ω—É—Å –¥–∞–µ–º 10 –æ—á–∫–æ–≤
            player.speed += 0.5; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –∏–≥—Ä–æ–∫–∞
            bonuses.splice(index, 1); // –£–¥–∞–ª—è–µ–º –±–æ–Ω—É—Å –∏–∑ –º–∞—Å—Å–∏–≤–∞
          }
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        if (Math.random() < 0.02) spawnObstacle();
        if (Math.random() < 0.02) spawnBonus();
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // –†–∏—Å—É–µ–º –∏–≥—Ä–æ–∫–∞
        ctx.fillStyle = "blue";
        ctx.fillRect(player.x, player.y, player.size, player.size);

        // –†–∏—Å—É–µ–º —à–∏–ø—ã
        ctx.fillStyle = "red";
        obstacles.forEach((obstacle) => {
          ctx.fillRect(obstacle.x, obstacle.y, obstacle.size, obstacle.size);
        });

        // –†–∏—Å—É–µ–º –±–æ–Ω—É—Å—ã
        ctx.fillStyle = "green";
        bonuses.forEach((bonus) => {
          ctx.beginPath();
          ctx.arc(bonus.x, bonus.y, bonus.size, 0, Math.PI * 2);
          ctx.fill();
        });

        // –†–∏—Å—É–µ–º —Å—á–µ—Ç
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.fillText("–û—á–∫–∏: " + score, 10, 20);
      }

      function gameLoop() {
        update();
        draw();
      }

      initGame();
    </script>
  </body>
</html>
