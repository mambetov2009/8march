<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ú–æ–Ω—Å—Ç—Ä –ö—É–±</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #000;
        color: white;
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 10px;
      }
      h1 {
        margin-bottom: 10px;
        font-size: 28px;
      }
      canvas {
        background: rgb(70, 29, 29);
        display: block;
        margin: 10px auto;
        border: 2px solid black;
        max-width: 100%;
        touch-action: none;
      }
      .controls {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 10px;
      }
      button {
        margin: 5px;
        padding: 16px 22px;
        font-size: 24px;
        border: none;
        border-radius: 12px;
        background: #444;
        color: white;
        cursor: pointer;
        min-width: 60px;
      }
      button:active {
        background: #666;
      }
      .high-score {
        font-size: 18px;
        margin-bottom: 10px;
      }
      .difficulty,
      .skins {
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <h1>–ú–û–ù–°–¢–† –ö–£–ë!</h1>
    <p class="high-score">–õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <span id="highScore">0</span></p>

    <div class="difficulty">
      <label for="difficulty">–°–ª–æ–∂–Ω–æ—Å—Ç—å:</label>
      <select id="difficulty">
        <option value="easy">–õ–µ–≥–∫–∏–π</option>
        <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
        <option value="hard">–°–ª–æ–∂–Ω—ã–π</option>
      </select>
    </div>

    <div class="skins">
      <label for="skins">–°–∫–∏–Ω –∏–≥—Ä–æ–∫–∞:</label>
      <select id="skins">
        <option value="blue">–°–∏–Ω–∏–π</option>
        <option value="green">–ó–µ–ª–µ–Ω—ã–π</option>
        <option value="purple">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
      </select>
    </div>

    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="controls">
      <button onclick="move('up')">‚¨Ü</button>
    </div>
    <div class="controls">
      <button onclick="move('left')">‚¨Ö</button>
      <button onclick="move('down')">‚¨á</button>
      <button onclick="move('right')">‚û°</button>
    </div>
    <div class="controls">
      <button onclick="restartGame()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>

    <audio id="gameMusic" loop>
      <source src="game-music.mp3" type="audio/mpeg" />
    </audio>
    <audio id="bonusSound">
      <source
        src="./ce91f212-711b-4466-b791-6360e67988e4_tiktok.mp4"
        type="audio/mpeg"
      />
    </audio>

    <script>
      const canvas = document.getElementById("gameCanvas");
      const ctx = canvas.getContext("2d");
      let player, enemies, coins, score, keys, difficulty, playerColor;
      let highScore = localStorage.getItem("highScore") || 0;
      document.getElementById("highScore").textContent = highScore;
      let gameMusic = document.getElementById("gameMusic");
      let bonusSound = document.getElementById("bonusSound");

      function initGame() {
        difficulty = document.getElementById("difficulty").value;
        playerColor = document.getElementById("skins").value;
        let speedFactor =
          difficulty === "easy" ? 0.01 : difficulty === "hard" ? 0.03 : 0.02;

        player = { x: 180, y: 180, size: 20, speed: 4 };
        enemies = [
          { x: 50, y: 50, size: 20, speedFactor },
          { x: 350, y: 350, size: 20, speedFactor },
        ];
        coins = generateCoins(10); // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 10 –º–æ–Ω–µ—Ç
        score = 0;
        keys = {};
        gameMusic.play();
      }

      function move(direction) {
        keys = {};
        keys[
          direction === "up"
            ? "ArrowUp"
            : direction === "down"
            ? "ArrowDown"
            : direction === "left"
            ? "ArrowLeft"
            : "ArrowRight"
        ] = true;
      }

      function restartGame() {
        if (score > highScore) {
          highScore = score;
          localStorage.setItem("highScore", highScore);
          document.getElementById("highScore").textContent = highScore;
        }
        initGame();
      }

      function generateCoins(number) {
        let coinsArray = [];
        for (let i = 0; i < number; i++) {
          coinsArray.push({
            x: Math.random() * (canvas.width - 20),
            y: Math.random() * (canvas.height - 20),
            size: 10,
            active: true,
          });
        }
        return coinsArray;
      }

      function update() {
        if (keys["ArrowUp"] && player.y > 0) player.y -= player.speed;
        if (keys["ArrowDown"] && player.y < canvas.height - player.size)
          player.y += player.speed;
        if (keys["ArrowLeft"] && player.x > 0) player.x -= player.speed;
        if (keys["ArrowRight"] && player.x < canvas.width - player.size)
          player.x += player.speed;

        enemies.forEach((enemy) => {
          enemy.x += (player.x - enemy.x) * enemy.speedFactor;
          enemy.y += (player.y - enemy.y) * enemy.speedFactor;
          enemy.x = Math.max(0, Math.min(canvas.width - enemy.size, enemy.x));
          enemy.y = Math.max(0, Math.min(canvas.height - enemy.size, enemy.y));
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ —Å –≤—Ä–∞–≥–∞–º–∏
        enemies.forEach((enemy) => {
          if (
            Math.hypot(player.x - enemy.x, player.y - enemy.y) < player.size
          ) {
            alert("–¢—ã –ø—Ä–æ–∏–≥—Ä–∞–ª! –û—á–∫–∏: " + score);
            restartGame();
          }
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–±–æ—Ä –º–æ–Ω–µ—Ç
        coins.forEach((coin, index) => {
          if (
            coin.active &&
            Math.hypot(player.x - coin.x, player.y - coin.y) < player.size
          ) {
            score += 10; // –ó–∞ –∫–∞–∂–¥—É—é –º–æ–Ω–µ—Ç—É –¥–∞–µ–º 10 –æ—á–∫–æ–≤
            bonusSound.play();
            coin.active = false; // –î–µ–ª–∞–µ–º –º–æ–Ω–µ—Ç—É –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ—Å–ª–µ —Å–±–æ—Ä–∞
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –º–æ–Ω–µ—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω–æ–π
            coins[index] = {
              x: Math.random() * (canvas.width - 20),
              y: Math.random() * (canvas.height - 20),
              size: 10,
              active: true,
            };
          }
        });

        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á–µ—Ç–∞
        score++;
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = playerColor;
        ctx.fillRect(player.x, player.y, player.size, player.size);

        // –†–∏—Å—É–µ–º –≤—Ä–∞–≥–æ–≤
        enemies.forEach((enemy) => {
          ctx.fillStyle = `rgba(255, 0, 0, ${
            0.5 + Math.sin(Date.now() * 0.005) * 0.5
          })`;
          ctx.fillRect(enemy.x, enemy.y, enemy.size, enemy.size);
        });

        // –†–∏—Å—É–µ–º –º–æ–Ω–µ—Ç—ã
        coins.forEach((coin) => {
          if (coin.active) {
            ctx.fillStyle = "yellow";
            ctx.beginPath();
            ctx.arc(coin.x, coin.y, coin.size, 0, Math.PI * 2);
            ctx.fill();
          }
        });

        // –†–∏—Å—É–µ–º —Å—á–µ—Ç
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.fillText("–û—á–∫–∏: " + score, 10, 20);
      }

      function gameLoop() {
        update();
        draw();
        requestAnimationFrame(gameLoop);
      }

      initGame();
      gameLoop();
    </script>
  </body>
</html>
